###############################
# Narrative Progression Events
# by Maximilian Olbers
###############################

namespace = story

### 1 - Microbial, simple plant life
country_event = {
	id = story.1
	title = story.1.name
	desc = {
		trigger = {
			switch = {
				trigger = has_ethic
				ethic_fanatic_spiritualist = { text = story.1.desc.spiri }
				ethic_fanatic_xenophobe = { text = story.1.desc.phobe }
				ethic_fanatic_xenophile = { text = story.1.desc.phile }
				ethic_spiritualist = { text = story.1.desc.spiri }
				ethic_xenophobe = { text = story.1.desc.phobe }
				ethic_xenophile = { text = story.1.desc.phile }
				ethic_gestalt_consciousness = {
					if = {
						limit = { has_civic = civic_machine_terminator }
						text = story.1.desc.term
						else = { text = story.1.desc.gesta }
					}
				}
				default = { text = story.1.desc }
			}
		}
	}

	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		is_country_type = default
		NOR = {
			has_country_flag = Story1
			has_country_flag = Story2
			has_country_flag = Story3
			has_country_flag = Story4
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = StoryFirst
		set_country_flag = Story1
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = INTRIGUING
	}
	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = DISCONCERTING
	}
}

### 2 - Spacers
country_event = {
	id = story.2
	title = story.2.name
	# First
	desc = {
		trigger = {
			NOR = {
				has_country_flag = StoryFirst
				has_ethic = ethic_gestalt_consciousness
			}
		}
		text = story.2.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.2.desc.gesta
	}	
	# Xenophile regardless of status
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
		text = story.2.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			has_country_flag = Story1
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		text = story.2.desc.followup
	}
	# Fallback
	desc = {
		trigger = {
			has_country_flag = StoryFirst
			NOR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
				has_ethic = ethic_gestalt_consciousness
			}
		}
		text = story.2.desc
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner
#	location = from

	is_triggered_only = yes

	trigger = {
		NOT = {
			has_country_flag = Story2
			has_country_flag = Story3
			has_country_flag = Story4
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
			#has_country_flag = Story8
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story2
	}

	option = {
		name = FASCINATING
	}
}

### 3 - Animalia
country_event = {
	id = story.3
	title = story.3.name
	# First
	desc = {
		text = story.3.desc
		trigger = {
			NOT = {
				has_country_flag = StoryFirst
			}
		}
	}
	# Gestalt Consciousness
	desc = {
		text = story.3.desc.gesta
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}	
	# Spiritualist regardless of status
	desc = {
		text = story.3.desc.spiri
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
	}
	# Followup
	desc = {
		trigger = { OR = { has_country_flag = Story1 has_country_flag = Story2 } }
		text = story.3.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOT = {
			has_country_flag = Story3
			has_country_flag = Story4
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		#set_country_flag = Story3
		set_country_flag = root
	}

	option = {
		name = INTERESTING
	}
}

### 4 - Pre-Sapients
country_event = {
	id = story.4
	title = story.4.name
	# First
	desc = {
		trigger = { NOT = {has_country_flag = StoryFirst } }
		text = story.4.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.4.desc.gesta
	}	
	# Fanatic Spiritualist regardless of status
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_spiritualist has_ethic = ethic_spiritualist } }
		text = story.4.desc.spiri
	}
	# Xenophobe
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophobe
			}
		}
		text = story.4.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
		text = story.4.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
			}
		}
		text = story.4.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOT = {
			has_country_flag = has_uplifted_species
			has_country_flag = Story4
			has_country_flag = Story41
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story4
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = FASCINATING
	}

	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = DISCONCERTING
	}

}

### 5 - Remnants
country_event = {
	id = story.5
	title = story.5.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.5.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.5.desc.gesta
	}	
	# Xenophobe
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		text = story.5.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.5.desc.phile
	}
	# Followup
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
			}
		}
		text = story.5.desc.followup
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOT = {
			has_country_flag = Story5
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story5
	}

	option = {
		name = REMARKABLE
	}
}

### 6 - Primitives
country_event = {
	id = story.6
	title = story.6.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.6.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.6.desc.gesta
	}	
	# Xenophobe
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		text = story.6.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.6.desc.phile
	}
	# Followup 5
	desc = {
		trigger = { has_country_flag = Story5 }
		text = story.6.desc.followup5
	}
	# Followup 4
	desc = {
		trigger = { has_country_flag = Story4 }
		text = story.6.desc.followup4
	}
	# Followup 1-2-3
	desc = {
		text = story.6.desc.followup123
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
			}
		}
	}
	picture = GFX_evt_news_room
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOR = {
			has_country_flag = Story6
			has_country_flag = Story7
		}
	}

	immediate = {
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		set_country_flag = Story6
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = INTERESTING
	}

	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = DISCONCERTING
	}
}

### 7 - Unknown Empire
country_event = {
	id = story.7
	title = story.7.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.7.desc
	}
	# Gestalt Consciousness
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.7.desc.gesta
	}	
	# Xenophobe
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		text = story.7.desc.phobe
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.7.desc.phile
	}
	# Followup 6
	desc = {
		trigger = { has_country_flag = Story6 }
		text = story.7.desc.followup6
	}
	# Followup 1-2-3-4-5
	desc = {
		trigger = {
			NOT = { has_authority = auth_machine_intelligence }
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
				has_country_flag = Story5
			}
		}
		text = story.7.desc.followup12345
	}
	# Followup 1-2-3-4-5 Machine Intelligences
	desc = {
		trigger = {
			has_authority = auth_machine_intelligence
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
				has_country_flag = Story5
			}
		}
		text = story.7.desc.mach.followup12345
	}
	picture = {
		picture = GFX_evt_news_room
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
	}
	picture = {
		picture = GFX_evt_unknown_ships
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}
	show_sound = event_scanner

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = Story7 }
		FROM = {
			NOR = {
				has_country_flag = radical_cult
				is_country_type = fallen_empire
				is_country_type = awakened_fallen_empire
				is_country_type = primitive
				is_guardian_country = yes
				has_relation_flag = { flag = no_coms who = root }
				has_relation_flag = { flag = AbandonedRefugees who = root }
				has_relation_flag = { flag = pirate_relation who = root }
				has_country_flag = day_0
			}
		}
	}

	immediate = {
		set_country_flag = Story7
		set_country_flag = has_encountered_other_empire
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
	}

	option = {
		trigger = { NOR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = INTRIGUING
	}
	option = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophobe has_ethic = ethic_xenophobe } }
		name = WORRYING
	}
}

### 8 - Leviathan
country_event = {
	id = story.8
	title = story.8.name
	# First
	desc = {
		trigger = { NOT = { has_country_flag = StoryFirst } }
		text = story.8.desc
	}
	# Hive Minds
	desc = {
		trigger = { has_authority = auth_hive_mind }
		text = story.8.desc.followup7
	}
	desc = {
		trigger = { has_authority = auth_machine_intelligence }
		text = story.8.desc.mach
	}
	# Spiritualist
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_spiritualist has_ethic = ethic_spiritualist } }
		text = story.8.desc.spirit
	}
	# Xenophile
	desc = {
		trigger = { OR = { has_ethic = ethic_fanatic_xenophile has_ethic = ethic_xenophile } }
		text = story.8.desc.phile
	}
	# Followup 6
	desc = {
		trigger = { has_country_flag = Story7 }
		text = story.8.desc.followup7
	}
	# Followup 1-2-3-4-5-6
	desc = {
		trigger = {
			OR = {
				has_country_flag = Story1
				has_country_flag = Story2
				has_country_flag = Story3
				has_country_flag = Story4
				has_country_flag = Story5
				has_country_flag = Story6
			}
		}
		text = story.8.desc.followup123456
	}
	picture = GFX_evt_unspeakable_horror
	show_sound = event_mystic_reveal

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = Story8 }
	}

	immediate = {
		set_country_flag = Story8
		if = {
			limit = { NOT = { has_country_flag = StoryFirst } }
			set_country_flag = StoryFirst
		}
		if = {
			limit = { NOT = { has_country_flag = first_alien_life } }
			set_country_flag = first_alien_life
		}
		if = {
			limit = { NOT = { has_country_flag = first_contact_event } }
			set_country_flag = first_contact_event
		}
	}

	option = {
		name = story.8.a
		trigger = {
			NOT = { has_country_flag = StoryFirst }
		}
	}
	option = {
		name = story.8.b
		trigger = {
			has_country_flag = StoryFirst
			NOT = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
				has_authority = auth_machine_intelligence
			}
		}
	}
	option = {
		name = story.8.c
		trigger = {
			has_country_flag = StoryFirst
			OR = {
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_xenophile
			}
		}
	}
	option = {
		name = story.8.d
		trigger = {
			has_country_flag = StoryFirst
			has_authority = auth_machine_intelligence
		}
	}
}

##############################
# Uchuukaijuu
##############################

### Tiyanki

#### Space Amoebas
# Triggered by action.15
country_event = {
	id = story.100
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = amoeba }
			establish_communications_no_message = ROOT
		}
		country_event = { id = story.101 }
	}
}

country_event = {
	id = story.101
	title = story.101.name
	desc = {
		trigger = {
			switch = {
				trigger = has_ethic
				ethic_fanatic_xenophile = { text = story.101.desc.phile }
				ethic_fanatic_xenophobe = { text = story.101.desc.phobe }
				ethic_fanatic_militarist = { text = story.101.desc.milit }
				ethic_fanatic_pacifist = { text = story.101.desc.pacif }
				ethic_fanatic_materialist = { text = story.101.desc.mater }
				ethic_xenophile = { text = story.101.desc.phile }
				ethic_xenophobe = { text = story.101.desc.phobe}
				ethic_militarist = { text = story.101.desc.milit }
				ethic_pacifist = { text = story.101.desc.pacif }
				ethic_materialist = { text = story.101.desc.mater }
				ethic_gestalt_consciousness = { text = story.101.desc.gesta }
				default = { text = story.101.desc.pacif }
			}
		}
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_space_amoeba
	location = fromfromfrom
	trackable = yes

	is_triggered_only = yes

	option = {
		name = story.101.aa
		trigger = {
			OR = {
				is_xenophobe = yes
				is_militarist = yes
				is_homicidal = yes
			}
		}
		add_modifier = {
			modifier = amoeba_hunting_buff
			days = -1
		}
		custom_tooltip = story.101.aa.amoebahunt
	}

	option = {
		name = story.101.bb
		trigger = {
			NOT = { has_civic = civic_machine_terminator }
		}
		capital_scope = {
			enable_special_project = {
				name = "AMOEBAS_PROJECT"
				location = this
				owner = root
			}
		}
	}

	option = {
		name = story.101.bb.exter
		trigger = {
			has_civic = civic_machine_terminator
		}
		capital_scope = {
			enable_special_project = {
				name = "AMOEBAS_PROJECT"
				location = this
				owner = root
			}
		}
	}

	option = {
		name = story.101.cc
		trigger = {
			OR = {
				is_xenophile = yes
				is_pacifist = yes
			}
		}
		capital_scope = {
			enable_special_project = {
				name = "AMOEBAS_PACIFICATION_PROJECT"
				location = this
				owner = root
			}
		}
	}
}

# Project complete
country_event = {
	id = story.105
	title = story.105.name
	desc = {
		trigger = {
			switch = {
				trigger = has_ethic
				ethic_fanatic_xenophile = { text = story.105.desc.phile }
				ethic_xenophile = { text = story.105.desc.phile }
				ethic_fanatic_pacifist = { text = story.105.desc.pacif }
				ethic_pacifist = { text = story.105.desc.pacif }
				ethic_gestalt_consciousness = { text = story.105.desc.gesta }
				default = { text = story.105.desc }
			}
		}
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_space_amoeba
	location = from

	is_triggered_only = yes

	option = {
		name = story.105.bb
		add_modifier = {
			modifier = flagellating_movement # +5% evasion
			days = -1
		}
	}

	option = {
		trigger = {
			NOT = { has_technology = tech_regenerative_hull_tissue }
		}
		name = story.105.aa
		add_research_option = tech_regenerative_hull_tissue
		add_tech_progress = {
			tech = tech_regenerative_hull_tissue
			progress = 0.5
		}
	}
}

# Pacification project complete
country_event = {
	id = story.107
	title = story.107.name
	desc = story.107.desc
	picture = GFX_evt_fleet_neutral
	show_sound = event_space_amoeba
	location = from

	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = amoeba }
			set_faction_hostility = {
				set_hostile = no
				set_friendly = yes
				target = root
			}
		}
	}

	option = {
		name = story.107.a
		custom_tooltip = story.107.a.tooltip
		hidden_effect = {
			add_modifier = {
				modifier = pacified_amoebas # friendly amoebas
				days = -1
			}
		}
		add_research_option = tech_amoeba_strike_craft_1
		IF = {
			limit = {
				NOR = {
					has_tech_option = tech_regenerative_hull_tissue
					has_technology = tech_regenerative_hull_tissue
				}
			}
			add_research_option = tech_regenerative_hull_tissue
		}
	}
}

# Amoeba kill-check for hunting buff
# This = owner of fleet 1 (combatant)
# From = owner of fleet 2 (destroyed)
# FromFrom = fleet 1
# FromFromFrom = fleet 2
country_event = {
	id = story.109
	trigger = {
		#is_ai = no
		exists = from
		from = { is_country_type = amoeba }
		has_modifier = amoeba_hunting_buff
	}
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		add_energy = 1000
	}
}

#### Crystals
# Triggered by action.16
country_event = {
	id = story.200
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		country_event = { id = story.201 days = 5 }
		every_country = {
			limit = { is_country_type = crystal }
			establish_communications_no_message = ROOT
		}
	}
}

country_event = {
	id = story.201
	title = story.201.name
	desc = {
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		text = story.201.desc.gesta
	}
	# Phile
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		text = story.201.desc.phile
	}
	# Phobe
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
			}
		}
		text = story.201.desc.phobe
	}
	# Pacif
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
		text = story.201.desc.pacif
	}
	# Spiri
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		text = story.201.desc.spiri
	}
	# Milit
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
			}
		}
		text = story.201.desc.milit
	}
	# Generic
	desc = {
		trigger = {
			NOR = {
				has_ethic = ethic_militarist
				has_ethic = ethic_fanatic_militarist
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_xenophobe
				has_ethic = ethic_fanatic_xenophobe
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		text = story.201.desc
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_crystal_ship
	location = fromfromfrom
	trackable = yes

	is_triggered_only = yes

	immediate = {
		set_country_flag = crystal_hostile_approach
		# changed on pacification project		
	}

	option = { # Hunting Buff
		name = story.201.aa
		trigger = {
			OR = {
				is_xenophobe = yes
				is_militarist = yes
				is_homicidal = yes
			}
		}
		add_modifier = {
			modifier = crystal_hunting_buff
			days = -1
		}
		custom_tooltip = story.201.aa.crystalhunt
	}

	option = { # Special Project
		name = story.201.bb
		capital_scope = {
			enable_special_project = {
				name = "CRYSTALS_PROJECT"
				location = this
				owner = root
			}
		}
	}

	option = {
		name = story.201.cc
		trigger = {
			OR = {
				is_xenophile = yes
				is_pacifist = yes
			}
		}
		capital_scope = {
			enable_special_project = {
				name = "CRYSTALS_PACIFICATION_PROJECT"
				location = this
				owner = root
			}
		}
	}
}

# Project complete
country_event = {
	id = story.205
	title = story.205.name
	desc = {
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		text = story.205.desc.gesta
	}
	# Phile
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
			}
		}
		text = story.205.desc.phile
	}
	# Pacifist
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
			}
		}
		text = story.205.desc.pacif
	}
	desc = {
		trigger = {
			NOT = {
				has_ethic = ethic_pacifist
				has_ethic = ethic_fanatic_pacifist
				has_ethic = ethic_xenophile
				has_ethic = ethic_fanatic_xenophile
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
		text = story.205.desc
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_crystal_ship
	location = from

	is_triggered_only = yes

	option = {
		name = story.205.bb
		add_modifier = {
			modifier = crystal_focus # +5% energy
			days = -1
		}
	}

	option = {
		name = story.205.aa
		add_research_option = tech_crystal_armor_1
		add_tech_progress = {
			tech = tech_crystal_armor_1
			progress = 0.5
		}
	}
}

# Pacification Project complete
country_event = {
	id = story.207
	title = story.207.name
	desc = story.207.desc
	picture = GFX_evt_fleet_evil
	show_sound = event_crystal_ship
	location = from

	is_triggered_only = yes

	immediate = {
		set_country_flag = crystal_nonhostile_approach
		every_country = {
			limit = { is_country_type = crystal }
			set_faction_hostility = {
				set_hostile = no
				set_friendly = yes
				target = root
			}
		}
	}

	option = {
		name = story.207.a
		custom_tooltip = story.207.a.tooltip
		hidden_effect = {
			add_modifier = {
				modifier = pacified_crystals # friendly crystals
				days = -1
			}
		}
		add_research_option = tech_crystal_armor_1
	}
}

# On-action check for destroyed crystal fleet
country_event = {
	id = story.216
	hide_window = yes
	is_triggered_only = yes
	trigger = {
		exists = from
		from = { is_country_type = crystal }
		has_modifier = crystal_hunting_buff
		is_ai = no
	}

	immediate = {
		add_minerals = 500
	}
}

# Crystal boss
fleet_event = {
	id = story.220
	title = story.220.name
	desc = {
		text = story.220.desc.gesta
		trigger = {
			owner = {
				has_ethic = ethic_gestalt_consciousness
			}
		}
	}
	desc = {
		text = story.220.desc.hostile
		trigger = {
			owner = {
				has_modifier = crystal_hunting_buff
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
	}
	desc = {
		text = story.220.desc.nonhostile
		trigger = {
			owner = {
				NOR = {
					has_country_flag = crystal_hunting_buff
					has_ethic = ethic_gestalt_consciousness
				}
			}
		}
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_crystal_ship
	location = root

	is_triggered_only = yes

	trigger = {
		from = {
			has_star_flag = crystal_home_system
			any_ship_in_system = {
				is_ship_size = crystal_station_large
			}
		}
		owner = {
			is_country_type = default
			OR = {
				has_country_flag = crystal_hostile_approach
				has_country_flag = crystal_nonhostile_approach
			}
			NOT = { has_country_flag = found_crystal_construct }
		}
	}

	immediate = {
		owner = {
			set_country_flag = found_crystal_construct
		}
	}

	option = {
		name = OK
		trigger = {
			owner = { NOT = { has_modifier = crystal_hunting_buff } }
		}
	}

	option = {
		name = BATTLESTATIONS
		trigger = {
			owner = { has_modifier = crystal_hunting_buff }
		}
	}
}

country_event = {
	id = story.222
	title = story.222.name
	desc = story.222.desc
	picture = GFX_evt_fleet_evil
	show_sound = event_crystal_ship
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		is_country_type = default
		from = {
			is_country_type = crystal
		}
		fromfromfrom = {
			is_ship_size = crystal_station_large
		}
	}

	option = {
		name = OK
		add_research_option = tech_crystal_armor_2
	}
}

### Drones
# Triggered by action.17
country_event = {
	id = story.300
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = drone }
			establish_communications = ROOT
		}
		country_event = { id = story.301 days = 5 }
	}
}

country_event = {
	id = story.301
	title = story.301.name
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.301.desc.gesta
	}
	# Phile
	desc = {
		trigger = {
			OR = { has_ethic = ethic_materialist has_ethic = ethic_fanatic_materialist }
		}
		text = story.301.desc.mater
	}
	# Phobe
	desc = {
		trigger = {
			OR = { has_ethic = ethic_pacifist has_ethic = ethic_fanatic_pacifist }
		}
		text = story.301.desc.pacif
	}
	# Generic
	desc = {
		trigger = {
			NOT = {
				has_ethic = ethic_materialist has_ethic = ethic_fanatic_materialist has_ethic = ethic_pacifist has_ethic = ethic_fanatic_pacifist
			}
		}
		text = story.301.desc
	}
	picture = GFX_evt_mining_station

	show_sound = event_ancient_drone
	location = from
	trackable = yes

	is_triggered_only = yes

	option = {
		name = story.301.a
		capital_scope = {
			enable_special_project = {
				name = "DRONES_PROJECT"
				location = this
				owner = root
			}
		}
	}
}

# Project complete
country_event = {
	id = story.305
	title = story.305.name
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = story.305.desc.gesta
	}
	# Phile
	desc = {
		trigger = { OR = { has_ethic = ethic_pacifist has_ethic = ethic_fanatic_pacifist } }

		text = story.305.desc.pacif
	}
	# Pacifist
	desc = {
		trigger = { OR = { has_ethic = ethic_materialist has_ethic = ethic_fanatic_materialist } }
		text = story.305.desc.mater
	}
	desc = {
		trigger = { NOT = { has_ethic = ethic_materialist has_ethic = ethic_fanatic_materialist has_ethic = ethic_pacifist has_ethic = ethic_fanatic_pacifist } }
		text = story.305.desc
	}
	picture = GFX_evt_mining_station
	show_sound = event_ancient_drone
	location = from

	is_triggered_only = yes

	option = {
		name = story.305.aa
		add_modifier = {
			modifier = drone_hunting_buff
			days = -1
		}
	}

	option = {
		name = story.305.bb
		add_modifier = {
			modifier = drone_mining_techniques #+5% minerals
			days = -1
		}
	}
}

# Entering drone home system
fleet_event = {
	id = story.330
	title = story.330.name
	desc = {
		text = story.330.desc.gesta
		trigger = {
			owner = {
				has_ethic = ethic_gestalt_consciousness
			}
		}
	}
	desc = {
		text = story.330.desc
		trigger = {
			owner = {
				NOT = { has_ethic = ethic_gestalt_consciousness }
			}
		}
	}
	picture = GFX_evt_mining_station
	show_sound = event_ancient_drone

	is_triggered_only = yes

	trigger = {
		exists = event_target:drone_country
		owner = {
			has_communications = event_target:drone_country
			NOT = { has_country_flag = seen_drone_home }
		}
		from = {
			has_star_flag = drone_home_system
		}
	}

	immediate = {
		owner = {
			set_country_flag = seen_drone_home
		}
	}

	option = {
		name = story.330.a
	}
}

# station destroyed
country_event = {
	id = story.332
	title = story.332.name
	desc = story.332.desc
	picture = GFX_evt_exploding_ship
	location = fromfrom

	is_triggered_only = yes

	trigger = {
		exists = event_target:drone_country
		from = {
			is_same_value = event_target:drone_country
		}
		fromfromfrom = { has_fleet_flag = ore_grinder }
	}

	option = {
		name = story.332.a
		add_minerals = 12000
	}
}

### Space Clouds
# Triggered by action.18
country_event = {
	id = story.400
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = cloud }
			establish_communications = ROOT
		}
		country_event = { id = story.401 days = 5 }
	}
}

country_event = {
	id = story.401
	title = story.401.name
	desc = {
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		text = story.401.desc.gesta
	}
	# Spiri
	desc = {
		trigger = { OR = { has_ethic = ethic_spiritualist has_ethic = ethic_fanatic_spiritualist } }
		text = story.401.desc.spiri
	}
	desc = {
		trigger = { NOT = { has_ethic = ethic_spiritualist has_ethic = ethic_fanatic_spiritualist } }
		text = story.401.desc
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_space_cloud
	location = fromfromfrom
	trackable = yes

	is_triggered_only = yes

	option = {
		name = story.401.a.spiri
		trigger = { is_spiritualist = yes }
		capital_scope = {
			enable_special_project = {
				name = "CLOUDS_PROJECT"
				location = this
				owner = root
			}
		}
	}

	option = {
		name = story.401.c
		trigger = { NOT = { is_spiritualist = yes } }
		capital_scope = {
			enable_special_project = {
				name = "CLOUDS_PROJECT"
				location = this
				owner = root
			}
		}
	}
}

# project complete
country_event = {
	id = story.405
	title = story.405.name
	desc = {
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		text = story.405.desc.gesta
	}
	# Spiri
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		text = story.405.desc.spiri
	}
	desc = {
		trigger = {
			NOR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_gestalt_consciousness
			}
		}
		text = story.405.desc
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_space_cloud
	location = from

	is_triggered_only = yes

	option = {
		name = story.405.b
		add_modifier = {
			modifier = cloud_hunting_buff
			days = -1
		}
	}

	option = {
		name = story.405.a.spiri
		add_modifier = {
			modifier = void_loops
			days = -1
		}
	}
}

### Tiyanki
# Triggered by action.25
country_event = {
	id = story.500
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = tiyanki }
			establish_communications_no_message = ROOT
		}
		country_event = { id = story.501 days = 5 }
	}
}

country_event = {
	id = story.501
	title = story.501.name
	desc = {
		trigger = {
			has_ethic = ethic_gestalt_consciousness
		}
		text = story.501.desc.gesta
	}
	# Spiri
	desc = {
		trigger = {
			OR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
			}
		}
		text = story.501.desc.spiri
	}
	desc = {
		trigger = {
			NOR = {
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_gestalt_consciousness
			}
		}
		text = story.501.desc
	}
	picture = GFX_evt_fleet_evil
	show_sound = event_alien_nature
	location = from

	is_triggered_only = yes

	option = {
		name = story.501.a.spiri
		trigger = {
			OR = {
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_spiritualist
			}
		}
		if = {
			limit = {
				has_tech_option = tech_space_whale_weapon_1
			}
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.6
			}
		}
		else = {
			add_research_option = tech_space_whale_weapon_1
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.2
			}
		}
	}

	option = {
		name = story.501.a.mater
		trigger = {
			OR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_gestalt_consciousness
			}
		}
		if = {
			limit = {
				has_tech_option = tech_space_whale_weapon_1
			}
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.3
			}
		}
		else = {
			add_research_option = tech_space_whale_weapon_1
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.1
			}
		}
	}

	option = {
		name = OK
		trigger = {
			NOR = {
				has_ethic = ethic_materialist
				has_ethic = ethic_fanatic_materialist
				has_ethic = ethic_spiritualist
				has_ethic = ethic_fanatic_spiritualist
				has_ethic = ethic_gestalt_consciousness
			}
		}
		if = {
			limit = {
				has_tech_option = tech_space_whale_weapon_1
			}
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.3
			}
		}
		else = {
			add_research_option = tech_space_whale_weapon_1
			add_tech_progress = {
				tech = tech_space_whale_weapon_1
				progress = 0.1
			}
		}
	}
}
